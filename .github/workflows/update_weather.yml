name: Update Suwon Weather

on:
  schedule:
    # 매 30분마다 (UTC 기준). 한국 시간과 상관없이 30분 간격으로 실행된다고 보시면 됩니다.
    - cron: "*/30 * * * *"
  workflow_dispatch: # 필요하면 GitHub UI에서 수동으로도 실행할 수 있게 함
    inputs: {}

permissions:
  contents: write   # GITHUB_TOKEN으로 커밋/푸시하려면 contents: write 권한 필요

jobs:
  update-weather:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests

      - name: Generate Suwon weather JSON
        run: |
          python fetch_weather.py

      - name: Commit and push changes
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          git add data/suwon_weather.json

          # 변경사항이 없으면 commit이 실패하니까, 실패해도 무시하도록 처리
          git commit -m "Update Suwon weather data" || echo "No changes to commit"

          git push origin HEAD:main
